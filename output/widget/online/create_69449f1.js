define("ops:widget/online/create.jsx",function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},o=e("ops:components/react/react.js"),s=a(o),l=e("ops:components/antd/lib/index.js"),i=e("reqwest"),u=a(i),d=e("ops:widget/online/errno.js"),p=a(d),m=l.Form.Item,f=l.Steps.Step,c=s["default"].createClass({displayName:"CreateForm",componentWillReceiveProps:function(){this.render(),this.refs.moduleName.refs.input.value="",this.refs.moduleVersion.refs.input.value=""},getInitialState:function(){return{isReRender:this.props.isReRender}},render:function(){var e={labelCol:{span:6},wrapperCol:{span:16}};return s["default"].createElement("div",{className:this.props.isShow?"show":"hidden"},s["default"].createElement(l.Form,{horizontal:!0},s["default"].createElement(m,n({label:"模块名称"},e,{required:!0}),s["default"].createElement(l.Input,{ref:"moduleName"})),s["default"].createElement(m,n({label:"模块版本"},e,{required:!0}),s["default"].createElement(l.Input,{ref:"moduleVersion"})),s["default"].createElement(m,{wrapperCol:{span:10,offset:6},style:{marginTop:24}},s["default"].createElement(l.Button,{type:"primary",onClick:this.addModule,htmlType:"submit"},"添加"))))},addModule:function(){var e=this,t=e.refs.moduleName.refs.input.value.trim(),r=e.refs.moduleVersion.refs.input.value.trim();return""==t||""==r?void l.message.error("模块名称和版本不能为空",4):void u["default"]({type:"JSON",url:"/v1/order/moduleInfo",headers:{"UUAP-USERNAME":e.props.userName},data:{modulename:t}}).then(function(t){if(200==t.status){var a=JSON.parse(t.response);0==a.errno?(e.props.onGetModuleInfo(a.data),e.props.onGetVersion(r),e.props.onNextStep(1),e.props.onChangeShow(!1,!0,!0)):l.message.error("该模块不存在  "+p["default"](a.errno),4)}})}}),c=l.Form.create()(c),h=s["default"].createClass({displayName:"CreateTable",render:function(){var e=[{title:"模块名称",dataIndex:"module_name",key:"module_name"},{title:"创建人",dataIndex:"creator_name",key:"creator_name"},{title:"模块描述",dataIndex:"module_des",key:"module_des"},{title:"BNS列表",dataIndex:"bns_server_name",key:"bns_server_name"},{title:"路径",dataIndex:"deploy_dir",key:"deploy_dir"}];return s["default"].createElement("div",{className:this.props.isShow?"show":"hidden"},s["default"].createElement(l.Table,{columns:e,dataSource:this.props.moduleInfo}))}}),v=s["default"].createClass({displayName:"CreateInput",componentWillReceiveProps:function(){this.render(),this.refs.concurrency.refs.input.value="",this.refs.name.refs.input.value="",this.refs.before.refs.input.value="",this.refs.after.refs.input.value=""},render:function(){var e=this,t={labelCol:{span:6},wrapperCol:{span:16}};return s["default"].createElement("div",{className:this.props.isShow?"show":"hidden"},s["default"].createElement(l.Form,{horizontal:!0},s["default"].createElement(m,n({label:"上线单名称"},t,{required:!0}),s["default"].createElement(l.Input,{ref:"name"})),s["default"].createElement(m,n({label:"并发度控制"},t),s["default"].createElement(l.Input,{ref:"concurrency"})),s["default"].createElement(m,n({label:"前置命令"},t),s["default"].createElement(l.Input,{ref:"before"})),s["default"].createElement(m,n({label:"后置命令"},t),s["default"].createElement(l.Input,{ref:"after"})),s["default"].createElement(m,{wrapperCol:{span:24,offset:6},style:{marginTop:24}},s["default"].createElement(l.Button,{type:"primary",onClick:this.lastStep,style:{marginRight:10}},"上一步"),s["default"].createElement(l.Button,{type:"primary",onClick:function(){e.create("justcreate")},style:{marginRight:10},htmlType:"submit"},"创建"),s["default"].createElement(l.Button,{type:"primary",onClick:function(){e.create("create")},htmlType:"submit"},"创建并上线"))))},lastStep:function(){this.props.onNextStep(0),this.props.onChangeShow(!0,!1,!1)},create:function(e){var t=this.refs.concurrency.refs.input.value,r=this.refs.name.refs.input.value.trim(),a=this.refs.before.refs.input.value,n=this.refs.after.refs.input.value,o=this;""==r&&l.message.error("上线单名称不能为空",4);var s={OrderName:r,OrderType:location.hash.indexOf("back")>=0?1:0,ModuleName:o.props.moduleInfo[0].module_name.trim(),ModuleVersion:o.props.moduleversion.trim(),OperationType:parseInt(t,10),HookBefore:a.trim(),HookAfter:n.trim()};u["default"]({type:"JSON",url:"/v1/order/commit",method:"post",headers:{"UUAP-USERNAME":o.props.userName},data:JSON.stringify({data:s})}).then(function(t){if(200==t.status){var r=JSON.parse(t.response);0==r.errno?(l.message.success("创建成功",3),"justcreate"==e?location.hash="online/list":(o.props.showDetail(!0),location.hash="online/detail?orderId="+r.data.Id),o.props.changeActivityTab(),o.props.onNextStep(2)):l.message.error("创建失败  "+p["default"](r.errno),4)}})}}),S=s["default"].createClass({displayName:"Create",componentWillReceiveProps:function(e){var t=this;t.setState({uuapUserName:e.userName}),this.setState("1"==this.props.activeKey?{isReRender:!0}:{isReRender:!1})},getInitialState:function(){return{showModuleForm:!0,showInputForm:!1,showTable:!1,currentStep:0,moduleInfo:[],moduleversion:"",isReRender:!1}},render:function(){var e=[{title:"添加模块"},{title:"创建上线单"},{title:"准备上线"},{title:"上线中"},{title:"完成"}].map(function(e,t){return s["default"].createElement(f,{key:t,title:e.title})});return s["default"].createElement("div",{className:"create_container"},s["default"].createElement(l.Row,{type:"flex",justify:"center",className:"step"},s["default"].createElement(l.Col,{span:"20"},s["default"].createElement(l.Steps,{current:this.state.currentStep},e))),s["default"].createElement(l.Row,null,s["default"].createElement(l.Col,{span:"8"},s["default"].createElement(c,{userName:this.props.userName,isReRender:this.state.isReRender,isShow:this.state.showModuleForm,onChangeShow:this.onChangeShow,onNextStep:this.onNextStep,onGetModuleInfo:this.onGetModuleInfo,onGetVersion:this.onGetVersion}),s["default"].createElement(v,{userName:this.props.userName,changeActivityTab:this.props.changeActivityTab,isShow:this.state.showInputForm,onChangeShow:this.onChangeShow,moduleInfo:this.state.moduleInfo,onNextStep:this.onNextStep,moduleversion:this.state.moduleversion,showDetail:this.props.showDetail})),s["default"].createElement(l.Col,{span:"16"},s["default"].createElement(h,{userName:this.props.userName,isShow:this.state.showTable,onChangeShow:this.onChangeShow,moduleInfo:this.state.moduleInfo}))))},onGetModuleInfo:function(e){this.setState({moduleInfo:e})},onChangeShow:function(e,t,r){this.setState({showModuleForm:e,showInputForm:r,showTable:t})},onNextStep:function(e){this.setState({currentStep:e})},onGetVersion:function(e){this.setState({moduleversion:e})}});t["default"]=S,r.exports=t["default"]});